<!DOCTYPE html>
<html lang="zxx" class="js">
<!-- Mirrored from dashlite.net/demo1/components/tables/table-datatable.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 May 2025 07:45:04 GMT -->
<!-- Added by HTTrack -->
<meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->

<head>
    <meta charset="utf-8">
    <meta name="author" content="Softnio">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="A powerful and conceptual apps base dashboard template that especially build for developers and programmers.">
    <link rel="shortcut icon" href="/images/coat.png">
    <title>Designation | School Management System</title>
       <link rel="stylesheet" href="/assets/css/style1.css">
    <link rel="stylesheet" href="../../assets/css/dashlitee1e3.css?ver=3.2.4">
    <link id="skin-default" rel="stylesheet" href="../../assets/css/themee1e3.css?ver=3.2.4">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-91615293-4"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-91615293-4');</script>
    <style>
        .spinner-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            /* Ensures it's above other content */
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgb(21, 21, 41, 0.5);
            color: #0c385f;
        }
                .nk-sidebar {
            background-color: #035994 !important;
            color: white !important;
        }
    </style>
</head>

<body class="nk-body bg-lighter npc-general has-sidebar ">
    <div class="nk-app-root">
        <div class="nk-main ">
            <%-include('sidebar.ejs')-%>
                <div class="nk-wrap ">
                    <%-include('header.ejs')-%>
                        <div class="nk-content ">
                            <div class="container-fluid">
                                <div class="nk-content-inner">
                                    <div class="nk-content-body">
                                        <div class="components-preview wide-md mx-auto">
                                            <div class="nk-block-head nk-block-head-lg wide-sm">
                                                <div class="nk-block-head-content">



                                                </div>
                                            </div>

                                            <div class="nk-block nk-block-lg">
                                                <div class="card card-bordered card-preview">
                                                    <div class="card-inner">
                                                        <div
                                                            class="d-flex justify-content-between align-items-center mb-4">
                                                            <h6 class="nk-block-title fw-normal">Registered Designation
                                                            </h6>
                                                            <button class="btn btn-primary" data-bs-toggle="modal"
                                                                data-bs-target="#addDesignationModal">Add
                                                                Designation</button>
                                                        </div>
                                                        <table class="datatable-init-export nowrap table"
                                                            data-export-title="Attendance">
                                                            <thead>
                                                                <tr>
                                                                    <th>#</th>
                                                                    <th>Designation name</th>
                                                                    <th>Staff Type</th>
                                                                    <th class="nk-tb-col nk-tb-col-tools text-end">
                                                                        Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <% designations.forEach((att, index)=> { %>
                                                                    <tr>
                                                                        <td>
                                                                            <%= index + 1 %>
                                                                        </td>
                                                                        <td>
                                                                            <%= att.name %>
                                                                        </td>
                                                                        <td>
                                                                            <%= att.type.name %>
                                                                        </td>
                                                                        <td class="nk-tb-col nk-tb-col-tools">
                                                                            <ul class="nk-tb-actions gx-1">
                                                                                <li>
                                                                                    <div class="drodown dropstart">
                                                                                        <!-- flipped to avoid clipping -->
                                                                                        <a href="#"
                                                                                            class="dropdown-toggle btn btn-icon btn-trigger"
                                                                                            data-bs-toggle="dropdown">
                                                                                            <em
                                                                                                class="icon ni ni-more-h"></em>
                                                                                        </a>
                                                                                        <div
                                                                                            class="dropdown-menu dropdown-menu-end">
                                                                                            <ul
                                                                                                class="link-list-opt no-bdr">
                                                                                                <li>
                                                                                                    <a href="#"
                                                                                                        onclick="fetchAndShowDesignationDetails('<%= att.id %>'); return false;">
                                                                                                        <em
                                                                                                            class="icon ni ni-eye"></em><span>Edit
                                                                                                            Details</span>
                                                                                                    </a>
                                                                                                </li>
                                                                                                <li>
                                                                                                    <a href="#"
                                                                                                        onclick="deleteDesignation('<%= att.id %>'); return false;">
                                                                                                        <em
                                                                                                            class="icon ni ni-na"></em><span>Delete
                                                                                                            Details</span>
                                                                                                    </a>
                                                                                                </li>
                                                                                            </ul>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                            </ul>
                                                                        </td>
                                                                    </tr>
                                                                    <% }) %>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100;"></div>
                        <div id="team-members-spinner" class="spinner-container" style="display:none;">
                            <div class="d-flex justify-content-center align-items-center vh-100">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"
                                    preserveAspectRatio="xMidYMid" width="200" height="200"
                                    style="shape-rendering: auto; display: block; background: transparent;"
                                    xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <g>
                                        <circle stroke-linecap="round" fill="none"
                                            stroke-dasharray="50.26548245743669 50.26548245743669" stroke="#035994"
                                            stroke-width="8" r="32" cy="50" cx="50">
                                            <animateTransform values="0 50 50;360 50 50" keyTimes="0;1"
                                                repeatCount="indefinite" dur="1s" type="rotate"
                                                attributeName="transform"></animateTransform>
                                        </circle>
                                        <circle stroke-linecap="round" fill="none" stroke-dashoffset="36.12831551628262"
                                            stroke-dasharray="36.12831551628262 36.12831551628262" stroke="#5b9573"
                                            stroke-width="8" r="23" cy="50" cx="50">
                                            <animateTransform values="0 50 50;-360 50 50" keyTimes="0;1"
                                                repeatCount="indefinite" dur="1s" type="rotate"
                                                attributeName="transform"></animateTransform>
                                        </circle>
                                        <g></g>
                                    </g>
                                </svg>
                            </div>
                        </div>
                        <%-include('footer.ejs')%>
                </div>
        </div>
    </div>

    <div class="modal fade" role="dialog" id="addDesignationModal">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content"><a href="#" class="close" data-bs-dismiss="modal"><em
                        class="icon ni ni-cross-sm"></em></a>
                <div class="modal-body modal-body-md">
                    <h5 class="title">Add Designation</h5>
                    <ul class="nk-nav nav nav-tabs">
                        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#infomation">Designation
                                Detail's</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="infomation">
                            <div class="row gy-4">
                                <div class="col-md-12">
                                    <div class="form-group"><label class="form-label" for="designation"> name</label>
                                        <div class="form-control-wrap"><input type="text" class="form-control"
                                                id="designation_name" placeholder="Enter designation">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group"><label class="form-label">Staff type</label>
                                        <div class="form-control-wrap"><select class="form-select js-select2"
                                                id="staff_type">
                                                <option value="">---select staff type---</option>
                                            </select></div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <ul class="align-center flex-wrap flex-sm-nowrap gx-4 gy-2">
                                        <li><a href="#" data-bs-dismiss="modal" class="btn btn-primary sgn"
                                                id="create-designation">Create Designation</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" role="dialog" id="editDesignationModal">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content"><a href="#" class="close" data-bs-dismiss="modal"><em
                        class="icon ni ni-cross-sm"></em></a>
                <div class="modal-body modal-body-md">
                    <h5 class="title">Edit Designation</h5>
                    <ul class="nk-nav nav nav-tabs">
                        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#infomation">Designation
                                Detail's</a></li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane active" id="infomation">
                            <div class="row gy-4">
                                <div class="col-md-12">
                                    <div class="form-group"><label class="form-label" for="designation"> name</label>
                                        <div class="form-control-wrap"><input type="text" class="form-control"
                                                id="edit_designation_name" placeholder="Enter designation"
                                                name="designation">
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" class="form-control" id="designation_ID" name="designation_ID">
                                <div class="col-md-12">
                                    <div class="form-group"><label class="form-label">Staff type</label>
                                        <div class="form-control-wrap"><select class="form-select js-select2"
                                                id="edit_staff_type" name="staff_type">
                                                <option value="">---select staff type---</option>
                                            </select></div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <ul class="align-center flex-wrap flex-sm-nowrap gx-4 gy-2">
                                        <li><a href="#" data-bs-dismiss="modal" class="btn btn-primary sgn"
                                                id="edit-designation">Edit Designation</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a class="pmo-st pmo-dark" target="_blank" href="https://softnio.com/get-early-access/">
        <div class="pmo-st-img"><img src="../../../images/landing/promo-investorm.png" alt="Investorm"></div>
        <div class="pmo-st-text">Looking for Advanced <br> Investment Platform?</div>
    </a>
    <script src="../../assets/js/bundlee1e3.js?ver=3.2.4"></script>
    <script src="../../assets/js/scriptse1e3.js?ver=3.2.4"></script>
    <script src="../../assets/js/demo-settingse1e3.js?ver=3.2.4"></script>
    <script src="../../assets/js/libs/datatable-btnse1e3.js?ver=3.2.4"></script>

    <script>
        $(document).ready(function () {
            if (!$.fn.DataTable.isDataTable('.datatable-init-export')) {
                $('.datatable-init-export').DataTable({
                    responsive: true,
                    dom: 'Bfrtip',
                    buttons: ['copy', 'csv', 'excel', 'pdf', 'print']
                });
            }
        });

        window.addEventListener('pageshow', function (event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {

                window.location.reload();
            }
        });

        $(document).ready(function () {
            const currentPath = window.location.pathname;
            console.log("Current Path:", currentPath);

            $(".nk-menu-link").each(function () {
                const linkPath = new URL(this.href).pathname;
                console.log("Link Path:", linkPath);
                if (linkPath === currentPath) {
                    $(this).addClass("active");
                } else {
                    $(this).removeClass("active");
                }
            });
        });

        $(document).ready(function () {
            $('#logout-link').on('click', function (e) {
                e.preventDefault();

                console.log('reached')
                $.ajax({
                    type: 'POST',
                    url: '/api/logout',
                    contentType: 'application/json',
                    success: function (response) {
                        showToast("Success", "Logged out in successfully", "text-success");
                        window.location.href = '/'
                    },
                    error: function (xhr) {
                        let message = "Request failed. Please try again.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            message = xhr.responseJSON.message;
                        }
                        showToast("Error", message, "text-danger");
                        return;
                    },
                });
            })

            function showToast(title, body, titleClass) {
                const toastHtml = `
                <div class="toast align-items-center text-bg-light border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="toast-header">
                        <strong class="me-auto ${titleClass}">${title}</strong>
                        <small class="text-muted">Now</small>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">${body}</div>
                </div>`;

                const $toast = $(toastHtml);
                $('.toast-container').append($toast);
                const toast = new bootstrap.Toast($toast[0]);
                toast.show();
            }
        })

        $(document).ready(async function () {

            $('#staff_type').select2({
                placeholder: "---select staff type---",
                allowClear: true
            });

            await loadStaffTypes();

            async function loadStaffTypes(selectedStaffTypeId = null) {
                $.ajax({
                    url: '/api/type',
                    method: 'GET',
                    success: function (response) {
                        const types = response.data;
                        const $select = $('#staff_type');
                        $select.empty();
                        $select.append('<option value="">---Select staff type---</option>');

                        types.forEach(function (t) {
                            const isSelected = t.id === selectedStaffTypeId ? 'selected' : '';
                            $select.append(`<option value="${t.id}" ${isSelected}>${t.name}</option>`);
                        });

                        $select.select2({
                            placeholder: "---Select staff type---",
                            dropdownParent: $('#addDesignationModal')
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Failed to load staff type:', error);
                    }
                });
            };

            $('#create-designation').on('click', function (e) {
                e.preventDefault();

                const name = $('#designation_name').val();
                const type_id = $('#staff_type').val();

                console.log({ name, type_id });


                if (!name || !type_id) {
                    showToast("Validation Error", "All fields are required.", "text-warning");
                    return;
                }

                const formData = {
                    name,
                    type_id
                };
                $('#team-members-spinner').show();
                console.log('formData:', formData)
                console.log('reached')
                $.ajax({
                    type: 'POST',
                    url: '/api/designation',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function (response) {

                        $('#addDesignationModal').modal('hide');
                        $('#designation_name').val();
                        $('#team-members-spinner').hide();

                        Swal.fire({
                            icon: 'success',
                            title: 'Created!',
                            text: 'Designation has been successfully created.',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.reload()
                        });
                    },
                    error: function (xhr) {
                        let message = "Request failed. Please try again.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            message = xhr.responseJSON.message;
                            $('#team-members-spinner').hide();
                        }
                        $('#designation_name').val();
                        showToast("Error", message, "text-danger");
                        $('#team-members-spinner').hide();
                        return;
                    },
                });
            })

        })

        $('#edit-designation').on('click', function (e) {
            e.preventDefault();

            const id = $('#editDesignationModal [name="designation_ID"]').val();
            const name = $('#editDesignationModal [name="designation"]').val();
            const type_id = $('#editDesignationModal [name="staff_type"]').val();
            const formData = {
                name, type_id
            };
            console.log('type:', formData)

            if (!name) {
                Swal.fire('Validation Error', 'Please fill all required fields', 'warning');
                return;
            }
            $('#team-members-spinner').show();
            $.ajax({
                url: `/api/designation/${id}`,
                method: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {
                    $('#editStaffModal').modal('hide');
                    $('#team-members-spinner').hide();
                   
                      Swal.fire({
                            icon: 'success',
                            title: 'Edited!',
                            text: 'Designation updated successfully.',
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.reload()
                        });

                },
                error: function (xhr) {
                    $('#team-members-spinner').hide();
                    let message = 'Failed to update Designation';
                    if (xhr.responseJSON && xhr.responseJSON.message) message = xhr.responseJSON.message;
                    Swal.fire('Error', message, 'error');
                }
            });
        });

        function deleteDesignation(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: `You are about to delete this designation. This action cannot be undone!`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel',
            }).then((result) => {
                if (result.isConfirmed) {
                    $('#team-members-spinner').show();
                    $.ajax({
                        url: `/api/designation/${id}`,
                        method: 'DELETE',
                        success: function (response) {
                            $('#team-members-spinner').hide();
                            Swal.fire('Deleted!', `designation has been deleted.`, 'success').then(() => {
                                window.location.reload()
                            });
                        },
                        error: function (xhr) {
                            $('#team-members-spinner').hide();
                            Swal.fire('Error', xhr.responseText || `Failed to delete designation`, 'error');
                        }
                    });
                }
            });
        }

        function fetchAndShowDesignationDetails(id) {
            $.ajax({
                url: `/api/designation/${id}`,
                method: 'GET',
                success: function (response) {
                    const data = response.data;
                    console.log(data);
                    $('#editDesignationModal [name="designation"]').val(data.name);
                    $('#editDesignationModal [name="designation_ID"]').val(data.id);
                    loadEditStaffTypes(data.type_id);
                    $('#editDesignationModal').modal('show');
                },
                error: function (xhr) {
                    Swal.fire('Error', xhr.responseText || 'Unable to fetch details', 'error');
                }
            });
        }

        async function loadEditStaffTypes(selectedStaffTypeId = null) {
            $.ajax({
                url: '/api/type',
                method: 'GET',
                success: function (response) {
                    const types = response.data;
                    const $select = $('#edit_staff_type');
                    $select.empty();
                    $select.append('<option value="">---Select staff type---</option>');

                    types.forEach(function (t) {
                        const isSelected = t.id === selectedStaffTypeId ? 'selected' : '';
                        $select.append(`<option value="${t.id}" ${isSelected}>${t.name}</option>`);
                    });


                    $select.select2({
                        placeholder: "---Select staff type---",
                        dropdownParent: $('#editDesignationModal')
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Failed to load staff type:', error);
                }
            });
        };


    </script>
</body>
<!-- Mirrored from dashlite.net/demo1/components/tables/table-datatable.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 07 May 2025 07:45:04 GMT -->

</html>